# 字节对齐

## 对齐原则

> 1. 数据类型自身的对齐值：
>    对于char型数据，其自身对齐值为1，对于short型为2，对于int,float,double类型，其自身对齐值为4，单位字节。
> 2. 结构体或者类的**自身对齐**值：**其成员中自身对齐值最大的那个值**。
> 3. **指定对齐**值：#pragma pack (value)时的指定对齐值value。
> 4. 数据成员、结构体和类的**有效对齐**值：自身对齐值和指定对齐值中**较小**的那个值。
> 5. 有效对齐值N是最终用来决定数据存放地址方式的值，最重要。有效对齐N，就是 表示“对齐在N上”，也就是说该数据的"**存放起始地址%N=0**".而数据结构中的数据变量都是按定义的先后顺序来排放的。第一个数据变量的起始地址就是数据结构的起始地址。**结构体的成员变量要对齐排放，结构体本身也要根据自身的有效对齐值圆整**(就是**结构体成员变量占用总长度需要是对结构体有效对齐值的整数倍**）

## 示例

```c
struct B
{
    char b;
    int a;
    short c;
};
```

> 分析：没有指定对齐，所以有效对齐为：b - 1, a  - 4, c - 2, B - 4
>
> b地址：0x0000, a地址：0x0004-0x0007,c地址：0x0008-0x0009,成员变量对齐后，长度为4 + 4 + 2 = 10
>
> B对齐，就是12 % 4 = 0

```c
#pragma pack (2) /*指定按2字节对齐*/
struct C
{
    char b;
    int a;
    short c;
};
```

> 分析：存在指定对齐，所以有效对齐：b:1, a: 2, c: 2, C：2，所以C的大小就是2 + 4 + 2 = 8