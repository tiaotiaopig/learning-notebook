# nohub 和 screen

> ​		我们通常使用本地终端登录远程服务器，一般的任务会随着终端的关闭而停止，但是有些任务，我们希望即使终端关闭，这些任务也能在后台运行，例如后台服务或者实验程序，这时候我们就需要使用一些命令，实现这一目的

## nohub

`nohub`的字面意思是不挂起（no hang up），通常和`&`(后台运行搭配使用)

```bash
# 后台运行脚本，输出信息到当前文件夹的nohub.out，& 脚本后台运行
# 如果当前文件夹的nohub.out不可写，输出重定向到 $HOME/nohup.out 文件中
nohub ./run.sh &
# 如果不需要输出文件或这日志
# 只输出错误信息到日志文件
nohup ./program >/dev/null 2>log &
# 什么信息也不要
nohup ./program >/dev/null 2>&1 &
# 0:表示标准输入
# 1:标准输出,在一般使用时，默认的是标准输出
# 2:标准错误信息输出
# Linux下还有一个特殊的文件/dev/null，它就像一个无底洞，所有重定向到它的信息都会消失得无影无踪
```

### 停止任务

```bash
# a:显示所有程序 
# u:以用户为主的格式来显示 
# x:显示所有程序，不以终端机来区分
# chat.js 是关键字
# 该操作可以查找进程
ps -aux|grep chat.js
# 上述命令最后一行总是会grep自己
# 用grep -v参数可以将grep命令排除掉
ps -aux|grep chat.js| grep -v grep
# 再用awk提取一下进程ID　
ps -aux|grep chat.js| grep -v grep | awk '{print $2}'
# 查看端口占用进程
lsof -i:8090
```

## screen

> **GNU Screen**是一款由GNU计划开发的用于命令行终端切换的自由软件。用户可以通过该软件同时连接多个本地或远程的命令行会话，并在其间自由切换。
>
> GNU Screen可以看作是窗口管理器的命令行界面版本。它提供了统一的管理多个会话的界面和相应的功能。
>
> - **会话恢复**
>
> 只要Screen本身没有终止，在其内部运行的会话都可以恢复。这一点对于远程登录的用户特别有用——即使网络连接中断，用户也不会失去对已经打开的命令行会话的控制。只要再次登录到主机上执行**screen -r**就可以恢复会话的运行。同样在暂时离开的时候，也可以执行分离命令**detach**，在保证里面的程序正常运行的情况下让Screen挂起（切换到后台）。这一点和图形界面下的VNC很相似。
>
> - **多窗口**
>
> 在Screen环境下，所有的会话都独立的运行，并拥有各自的编号、输入、输出和窗口缓存。用户可以通过快捷键在不同的窗口下切换，并可以自由的重定向各个窗口的输入和输出。Screen实现了基本的文本操作，如复制粘贴等；还提供了类似滚动条的功能，可以查看窗口状况的历史记录。窗口还可以被分区和命名，还可以监视后台窗口的活动。
>
> - **会话共享**
>
> Screen可以让一个或多个用户从不同终端多次登录一个会话，并共享会话的所有特性（比如可以看到完全相同的输出）。它同时提供了窗口访问权限的机制，可以对窗口进行密码保护。

```bash
screen -S yourname # 新建一个叫yourname的session
screen -ls # 列出当前所有的session
screen -r yourname # 回到yourname这个session
screen -d yourname # 远程detach某个session
screen -d -r yourname # 结束当前session并回到yourname这个session
# 进入某个session（窗口），使用exit命令或者ctr+d即可关闭窗口
```

